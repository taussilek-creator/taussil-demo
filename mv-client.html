  let lastW = window.innerWidth;
  window.addEventListener('resize', ()=>{
    if (!dlg || !dlg.open || !ridOpen) return;

    // على الجوال تغيّر الارتفاع شائع؛ لا نعيد الرسم إن لم يتغير العرض فعلياً
    const w = window.innerWidth;
    if (Math.abs(w - lastW) < 40) return;  // تجاهل اختلافات بسيطة
    lastW = w;

    // لو العرض حاليًا جوال، لا تعيد الرسم (تجنب رست الفئة)
    if (window.matchMedia('(max-width: 900px)').matches) return;

    clearTimeout(t);
    t = setTimeout(async ()=>{
      try{
        const rDoc = await fs.collection('restaurants').doc(ridOpen).get();
        if(!rDoc.exists) return;
        const r = { id: ridOpen, ...rDoc.data() };

        let cats = [], prods = [];
        const cs = await fs.collection('restaurants').doc(ridOpen).collection('categories').get();
        cs.forEach(d=> cats.push({id:d.id, ...d.data()}));
        const ps = await fs.collection('restaurants').doc(ridOpen).collection('products').get();
        ps.forEach(d=> prods.push({id:d.id, ...d.data()}));
        prods = prods.filter(p=> p.isAvailable !== false);

        // إعادة الرسم بحفاظ على الفئة (renderMenu صار يتكفّل بها للجوال)
        renderMenu(r, cats.sort((a,b)=>(a.sort??0)-(b.sort??0)), prods);
      }catch(_){}
    }, 200);
  });
